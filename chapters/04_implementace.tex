\chapter{Implementace aplikace}
Tato kapitola popisuje implementaci navržené architektury a klíčových částí aplikace.
Vzhledem k rozsahu výsledného řešení se zaměřuje především na zásadní a pro tento systém specifické prvky, které mají největší význam z hlediska návrhu a struktury aplikace.

Pozornost je věnována zejména implementaci reprezentace výsledků operací, práci s geografickými dotazy nad databází a stránkování jejich výsledků, správě stavu uživatelského rozhraní a bezpečnostním mechanismům.
Vybrané části ilustrují, jak se návrhová rozhodnutí popsaná v předchozí kapitole promítla do konkrétní realizace aplikace.


\section{Implementace doménové vrstvy}

\subsection{Reprezentace výsledků operací}
% Sealed class - implementace třídy
% Funkcionální styl zpracování výsledků
% Hierarchie doménových chyb (+ převedení na lokalizované texty v UI)

\subsection{Implementace use-case tříd}
% řetězení volání repozitářů
% řetězení výsledků (DomainResult)
% orchestrace operací
% izolace business logiky


\section{Implementace datové vrstvy}

\subsection{Mapování datových modelů a zpracování chyb}
% mapovaní entit do doménových modelů
% jednotné zachytávání výjimek (z API a SKD, převod na DomainError)
% mapování do DomainResult

\subsection{Geografické dotazy a stránkování}
% omezení Firestore (neumí radius query)
% geohash princip a volba
% ring partitioning (princip)
%  - nepřesnost, ale deterministické rozdělení dat/stránkování
% cursor-based paging
% aproximace vzdálenosti

\subsection{Kategorie obchodů v NoSQL databázi}
% denormalizace
% absence joinů
% popularity kolekce
% Cloud Function
% eventual consistency


\section{Implementace uživatelského rozhraní}

\subsection{Navigační graf aplikace}
% type-safe navigace
% vnořené grafy

\subsection{Správa stavu a vedlejší efekty}
% immutable state
% "reducer pattern"
% kombinace Flow
% oddělení efektů


\section{Bezpečnostní model a řízení přístupu}

\subsection{Firebase Security Rules}
% rules = kontrola autentizace a vlastnictví + strukturální validace (vstupy)
% mapování identity kvůli oddělení user id a authId
% shop: zákaz změny ownerId
% review: zákaz self-review
% category popularity: zákaz zápisu z klienta (jen cloud function)


\section{Shrnutí implementační části}
% Kolik modulů
% Přibližná velikost codebase (moduly a soubory)
% Vrstvení systému
% Jak se návrh osvědčil při vývoji

% 10-12 stran (TODO: smazat)